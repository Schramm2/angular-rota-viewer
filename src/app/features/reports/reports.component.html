<div class="reports-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-title">
        <div class="title-group">
          <h1 *ngIf="!isMemberRole()">Team Reports</h1>
          <h1 *ngIf="isMemberRole()">My Reports</h1>
          <p class="header-subtitle" *ngIf="isMemberRole()">
            Your personal shift statistics and performance insights
          </p>
          <p class="header-subtitle" *ngIf="!isMemberRole()">
            Comprehensive analytics and insights for team performance
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern Controls Panel -->
  <div class="controls-panel">
    <div class="controls-container">
      <div class="controls-content">
        <!-- Team Selection (hidden for member role) -->
        <mat-form-field *ngIf="!isMemberRole()" appearance="outline" class="control-field">
          <mat-label>Team</mat-label>
          <mat-select [formControl]="selectedTeamId" aria-label="Select team">
            <mat-option *ngFor="let team of teams$ | async" [value]="team.id">
              {{ team.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Date Range Controls -->
        <div class="date-range-controls">
          <mat-form-field appearance="outline" class="control-field">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startPicker" [formControl]="startDate" (dateChange)="onStartDateChange()" aria-label="Select start date">
            <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>

          <div class="date-separator">to</div>

          <mat-form-field appearance="outline" class="control-field">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endPicker" [formControl]="endDate" (dateChange)="onEndDateChange()" aria-label="Select end date">
            <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern KPI Section -->
  <div class="kpi-section" *ngIf="reportData$ | async as data">
    <div class="section-container">
      <div class="section-header">
        <h2 class="section-title">Key Metrics</h2>
        <div class="section-meta">Performance overview</div>
      </div>
      
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-content">
            <div class="kpi-icon-wrapper">
              <span class="kpi-abbreviation">TS</span>
            </div>
            <div class="kpi-details">
              <div class="kpi-value">{{ data.totalShifts }}</div>
              <div class="kpi-label" *ngIf="!isMemberRole()">Total Shifts</div>
              <div class="kpi-label" *ngIf="isMemberRole()">My Shifts</div>
              <div class="kpi-trend positive">
                <span class="trend-icon">↗</span>
                <span>+12%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="kpi-card" *ngIf="!isMemberRole()">
          <div class="kpi-content">
            <div class="kpi-icon-wrapper">
              <span class="kpi-abbreviation">MS</span>
            </div>
            <div class="kpi-details">
              <div class="kpi-value">{{ data.membersScheduled }}</div>
              <div class="kpi-label">Members Scheduled</div>
              <div class="kpi-trend neutral">
                <span class="trend-icon">→</span>
                <span>0%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-content">
            <div class="kpi-icon-wrapper">
              <span class="kpi-abbreviation">CV</span>
            </div>
            <div class="kpi-details">
              <div class="kpi-value">{{ data.coveragePercentage }}%</div>
              <div class="kpi-label" *ngIf="!isMemberRole()">Coverage %</div>
              <div class="kpi-label" *ngIf="isMemberRole()">My Coverage</div>
              <div class="kpi-trend" [class.positive]="data.coveragePercentage >= 80" [class.negative]="data.coveragePercentage < 60">
                <span class="trend-icon">{{ data.coveragePercentage >= 80 ? '↗' : data.coveragePercentage < 60 ? '↘' : '→' }}</span>
                <span>{{ data.coveragePercentage >= 80 ? '+5%' : data.coveragePercentage < 60 ? '-8%' : '0%' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="kpi-card" *ngIf="!isMemberRole()">
          <div class="kpi-content">
            <div class="kpi-icon-wrapper">
              <span class="kpi-abbreviation">FS</span>
            </div>
            <div class="kpi-details">
              <div class="kpi-value">{{ data.fairnessScore }}</div>
              <div class="kpi-label">Fairness Score</div>
              <div class="kpi-trend" [class.positive]="data.fairnessScore >= 80" [class.negative]="data.fairnessScore < 60">
                <span class="trend-icon">{{ data.fairnessScore >= 80 ? '↗' : data.fairnessScore < 60 ? '↘' : '→' }}</span>
                <span>{{ data.fairnessScore >= 80 ? '+3%' : data.fairnessScore < 60 ? '-5%' : '0%' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern Charts Section -->
  <div class="charts-section" *ngIf="reportData$ | async as data">
    <div class="section-container">
      <div class="section-header">
        <h2 class="section-title">Analytics Dashboard</h2>
        <div class="section-meta">Visual insights and trends</div>
      </div>
      
      <div class="charts-grid">
        <!-- Bar Chart: Shifts per Member -->
        <div class="chart-card" *ngIf="!isMemberRole() || data.shiftsPerMember.length > 0">
          <div class="chart-header">
            <div class="chart-title-group">
              <h3 class="chart-title" *ngIf="!isMemberRole()">Shifts per Member</h3>
              <h3 class="chart-title" *ngIf="isMemberRole()">My Shift Distribution</h3>
              <p class="chart-subtitle" *ngIf="!isMemberRole()">Distribution of shifts across team members</p>
              <p class="chart-subtitle" *ngIf="isMemberRole()">Your shift activity over the selected period</p>
            </div>
            <div class="chart-actions">
              <button mat-icon-button matTooltip="Export chart">
                <span class="icon-text">DL</span>
              </button>
            </div>
          </div>
          <div class="chart-content">
            <div class="chart-container">
              <canvas baseChart
                      [data]="barChartData"
                      [options]="barChartOptions"
                      [type]="barChartType"
                      [attr.aria-label]="isMemberRole() ? 'Your shift distribution chart' : 'Team shift distribution chart'">
              </canvas>
            </div>
          </div>
        </div>

        <!-- Line Chart: Daily Coverage -->
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-title-group">
              <h3 class="chart-title" *ngIf="!isMemberRole()">Daily Coverage %</h3>
              <h3 class="chart-title" *ngIf="isMemberRole()">My Daily Activity</h3>
              <p class="chart-subtitle" *ngIf="!isMemberRole()">Coverage percentage across the selected date range</p>
              <p class="chart-subtitle" *ngIf="isMemberRole()">Your shift activity across the selected date range</p>
            </div>
            <div class="chart-actions">
              <button mat-icon-button matTooltip="Export chart">
                <span class="icon-text">DL</span>
              </button>
            </div>
          </div>
          <div class="chart-content">
            <div class="chart-container">
              <canvas baseChart
                      [data]="lineChartData"
                      [options]="lineChartOptions"
                      [type]="lineChartType"
                      [attr.aria-label]="isMemberRole() ? 'Your daily activity chart' : 'Daily coverage chart'">
              </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern Empty State -->
  <div class="empty-state-section" *ngIf="(reportData$ | async)?.totalShifts === 0">
    <div class="section-container">
      <div class="empty-state">
        <div class="empty-content">
          <div class="empty-icon">
            <span class="empty-icon-text">IN</span>
          </div>
          <h3 class="empty-title" *ngIf="!isMemberRole()">No Data Available</h3>
          <h3 class="empty-title" *ngIf="isMemberRole()">No Shifts Found</h3>
          <p class="empty-description" *ngIf="!isMemberRole()">
            No shifts found for the selected team and date range. Try selecting a different team or adjusting the date range to see analytics data.
          </p>
          <p class="empty-description" *ngIf="isMemberRole()">
            You don't have any shifts scheduled in the selected date range. Try adjusting the date range or check with your team lead for upcoming assignments.
          </p>
          <div class="empty-actions">
            <button mat-stroked-button (click)="today()" *ngIf="!isMemberRole()">
              <span class="button-icon">TD</span>
              View This Week
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
